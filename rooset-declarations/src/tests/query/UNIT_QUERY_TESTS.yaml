---
label: Unit Query Tests
type: QUERY_TEST
key: unit-query

mocks:
  - &unitId 464b1ebb-32c1-460c-8e9e-000000000000
  - &areaId0 464b1ebb-32c1-460c-8e9e-111111111111
  - &areaId1 464b1ebb-32c1-460c-8e9e-222222222222
  - &policyId 464b1ebb-32c1-460c-8e9e-333333333333
  - &managerId 464b1ebb-32c1-460c-8e9e-444444444444
  - &policyQueryBody
      policyId: *policyId
      name: Test Policy
      description: The Test Policy
      votingAlgorithm: SCHULZE
      maxAdmissionTime: 604800000
      minAdmissionTime: 0
      discussionTime: 604800000
      verificationTime: 604800000
      votingTime: 604800000
      issueQuorumNum: 1
      issueQuorumDen: 10
      initiativeQuorumNum: 1
      initiativeQuorumDen: 10


scenarios:

  -
    label: Query Url Parameter name
    given: unit-created-with-areas
    when:
      label: The url parameter name is queried
      action:
        type: UNIT_URL_PARAMETER_NAME_QUERY_REQUEST
        payload:
          urlParameterName: test-unit
    then:
      label: The system responds with the unitId
      outcome:
        type: UNIT_URL_PARAMETER_NAME_QUERY_RESPONSE
        payload:
          id: *unitId


  -
    label: Query active unit
    given:
      key: unit-created-with-areas
      label: A unit has been created
      precondition:
        -
          type: UNIT_CREATED_EVENT
          payload:
            id: *unitId
            requesterId: *managerId
            name: "Test Unit"
            description: "The Test Unit"
            urlParameterName: "test-unit"
        -
          type: POLICY_CREATED_EVENT
          payload:
            <<: *policyQueryBody
            id: *unitId
            requesterId: *managerId

        -
          type: AREA_CREATED_EVENT
          payload:
            id: *unitId
            areaId: *areaId0
            requesterId: *managerId
            name: "area0"
            description: "The 0 Area"
            externalReference: "http://area0.org"
        -
          type: AREA_CREATED_EVENT
          payload:
            id: *unitId
            areaId: *areaId1
            requesterId: *managerId
            name: "area1"
            description: "The 1 Area"
            externalReference: "http://area1.org"
    when:
      label: The Unit is Queried
      action:
        type: UNIT_QUERY_REQUEST
        payload:
          id: *unitId
    then:
      label: System Responds
      outcome:
        type: UNIT_QUERY_RESPONSE
        payload:
          id: *unitId
          name: "Test Unit"
          description: "The Test Unit"
          policies:
            - *policyQueryBody
          areas:
            -
              areaId: *areaId0
              name: "area0"
              description: "The 0 Area"
              externalReference: "http://area0.org"
            -
              areaId: *areaId1
              name: "area1"
              description: "The 1 Area"
              externalReference: "http://area1.org"
