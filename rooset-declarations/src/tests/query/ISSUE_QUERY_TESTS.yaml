---
label: Issue Query Tests
type: QUERY_TEST
key: issue-query

mocks:
  - &unitId 464b1ebb-32c1-460c-8e9e-000000000000
  - &memberId1 464b1ebb-32c1-460c-8e9e-111111111111
  - &memberId2 464b1ebb-32c1-460c-8e9e-222222222222
  - &managerId 464b1ebb-32c1-460c-8e9e-333333333333
  - &initiativeId4 464b1ebb-32c1-460c-8e9e-444444444444
  - &initiativeId5 464b1ebb-32c1-460c-8e9e-555555555555
  - &areaId 464b1ebb-32c1-460c-8e9e-bbbbbbbbbbbb
  - &issueId 464b1ebb-32c1-460c-8e9e-aaaaaaaaaaaa
  - &policyId 464b1ebb-32c1-460c-8e9e-cccccccccccc

scenarios:


  -
    label: Query issue
    given:
      key: issue-with-2-initiatives
      label: A issue is created with 2 initiatives
      precondition:
        -
          type: NEW_INITIATIVE_CREATED_EVENT
          payload:
            id: *issueId
            requesterId: *memberId1
            initiativeId: *initiativeId4
            unitId: *unitId
            areaId: *areaId
            policyId: *policyId
            name: "Paint the bike shed"
            polling: false
            externalReference: "1234"
            content: "Paint the bike shed red"
            textSearchData: "bike, shed"
            created: 1487394829
        -
          type: COMPETING_INITIATIVE_CREATED_EVENT
          payload:
            id: *issueId
            requesterId: *memberId2
            initiativeId: *initiativeId5
            name: "Paint it green"
            externalReference: "5678"
            content: "Paint the bike shed green"
            textSearchData: "bike, shed"
            created: 1487394950
    when:
      label: The issue is queried
      action:
        type: ISSUE_QUERY_REQUEST
        payload:
          id: *issueId
    then:
      label: The system responds
      outcome:
        type: ISSUE_QUERY_RESPONSE
        payload:
          id: *issueId
          unitId: *unitId
          areaId: *areaId
          policyId: *policyId
          created: 1487394829
          issueState: ADMISSION
          initiatives:
            -
              key: *initiativeId4
              name: Paint the bike shed
            -
              key: *initiativeId5
              name: Paint it green
