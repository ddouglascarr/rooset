---
label: Unit Aggregate - Policy
key: unit-aggregate-policy-command
type: DOMAIN_COMMAND_TEST
mocks:
  - &unitCreatedEvent
    type: UNIT_CREATED_EVENT
    payload:
      id: 464b1ebb-32c1-460c-8e9e-111111111111
      requesterId: 464b1ebb-32c1-460c-8e9e-333333333333
      name: Test Unit
      description: The Test Unit
      urlParameterName: test-unit
  - &addPolicyCommandPayload
      id: 464b1ebb-32c1-460c-8e9e-111111111111
      requesterId: 464b1ebb-32c1-460c-8e9e-333333333333
      policyId: 464b1ebb-32c1-460c-8e9e-222222222222
      name: Test Policy
      description: The Test Policy
      votingAlgorithm: SCHULZE
      maxAdmissionTime: 604800000
      minAdmissionTime: 0
      discussionTime: 604800000
      verificationTime: 604800000
      votingTime: 604800000
      issueQuorumNum: 1
      issueQuorumDen: 10
      initiativeQuorumNum: 1
      initiativeQuorumDen: 10
  - &addPolicyCommand
    type: ADD_POLICY_COMMAND
    payload: *addPolicyCommandPayload
  - &policyAddedEvent
    type: POLICY_ADDED_EVENT
    payload:
      id: 464b1ebb-32c1-460c-8e9e-111111111111
      requesterId: 464b1ebb-32c1-460c-8e9e-333333333333
      policyId: 464b1ebb-32c1-460c-8e9e-222222222222
      name: Test Policy
      description: The Test Policy
      votingAlgorithm: SCHULZE
      maxAdmissionTime: 604800000
      minAdmissionTime: 0
      discussionTime: 604800000
      verificationTime: 604800000
      votingTime: 604800000
      issueQuorumNum: 1
      issueQuorumDen: 10
      initiativeQuorumNum: 1
      initiativeQuorumDen: 10

scenarios:

  -
    label: Add policy
    given:
      label: Unit Created
      key: unit-created
      precondition:
        - *unitCreatedEvent
    when: *addPolicyCommand
    then: *policyAddedEvent

  -
    label: requester must have managment rights
    given: unit-created
    when:
      <<: *addPolicyCommand
      payload:
        <<: *addPolicyCommandPayload
        requesterId: 464b1ebb-32c1-460c-8e9e-777777777777
    then:
      type: COMMAND_EVALUATION_EXCEPTION
      error: true
      payload:
        code: UNPRIVILEGED_EXCEPTION
        message: ''
