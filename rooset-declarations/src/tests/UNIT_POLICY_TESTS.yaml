---
label: Unit Aggregate - Policy
mocks:
  - &unitCreatedEvent
    type: UNIT_CREATED_EVENT
    payload:
      id: 464b1ebb-32c1-460c-8e9e-111111111111
      requesterId: 464b1ebb-32c1-460c-8e9e-333333333333
      name: Test Unit
      description: The Test Unit
  - &setUnitPolicyCommandPayload
      id: 464b1ebb-32c1-460c-8e9e-111111111111
      requesterId: 464b1ebb-32c1-460c-8e9e-333333333333
      policyId: 464b1ebb-32c1-460c-8e9e-222222222222
      name: Test Policy
      description: The Test Policy
      polling: false
      maxAdmissionTime: 604800000
      minAdmissionTime: 0
      discussionTime: 604800000
      verificationTime: 604800000
      votingTime: 604800000
      issueQuorumNum: 1
      issueQuorumDen: 10
      defeatStrength: SIMPLE
      directMajorityNum: 1
      directMajorityDen: 2
      directMajorityStrict: true
      directMajorityPositive: 1
      directMajorityNonNegative: 1
      noReverseBeatPath: false
      noMultistageMajority: false
  - &setUnitPolicyCommand
    type: SET_UNIT_POLICY_COMMAND
    payload: *setUnitPolicyCommandPayload
  - &unitPolicySetEvent
    type: UNIT_POLICY_SET_EVENT
    payload:
      id: 464b1ebb-32c1-460c-8e9e-111111111111
      requesterId: 464b1ebb-32c1-460c-8e9e-333333333333
      policyId: 464b1ebb-32c1-460c-8e9e-222222222222
      name: Test Policy
      description: The Test Policy
      polling: false
      maxAdmissionTime: 604800000
      minAdmissionTime: 0
      discussionTime: 604800000
      verificationTime: 604800000
      votingTime: 604800000
      issueQuorumNum: 1
      issueQuorumDen: 10
      defeatStrength: SIMPLE
      directMajorityNum: 1
      directMajorityDen: 2
      directMajorityStrict: true
      directMajorityPositive: 1
      directMajorityNonNegative: 1
      noReverseBeatPath: false
      noMultistageMajority: false

scenarios:

  -
    label: Set policy
    given:
      - *unitCreatedEvent
    when: *setUnitPolicyCommand
    then: *unitPolicySetEvent

  -
    label: requester must have managment rights
    given:
      - *unitCreatedEvent
    when:
      <<: *setUnitPolicyCommand
      payload:
        <<: *setUnitPolicyCommandPayload
        requesterId: 464b1ebb-32c1-460c-8e9e-777777777777
    then:
      type: COMMAND_EVALUATION_EXCEPTION
      error: true
      payload:
        code: UNPRIVILEGED_EXCEPTION
        message: ''
