---
label: Http Issue Tests
key: issue-http
type: HTTP_API_TEST

mocks:
  - &issueId 464b1ebb-32c1-460c-8e9e-666666666666
  - &voter4Id 464b1ebb-32c1-460c-8e9e-444444444444
  - &voter9Id 464b1ebb-32c1-460c-8e9e-999999999999
  - &areaId 464b1ebb-32c1-460c-8e9e-333333333333
  - &initiativeId 464b1ebb-32c1-460c-8e9e-777777777777
  - &competingInitiativeId 464b1ebb-32c1-460c-8e9e-000000000000
  - &unitId 464b1ebb-32c1-460c-8e9e-111111111111
  - &policyId 464b1ebb-32c1-460c-8e9e-888888888888
  - &created 1483586759
  - &competingCreated 1483586760

  - &newInitiativeCreatedEvent
    type: NEW_INITIATIVE_CREATED_EVENT
    payload:
      id: *issueId
      requesterId: *voter4Id
      initiativeId: *initiativeId
      unitId: *unitId
      areaId: *areaId
      policyId: *policyId
      name: 'Test Initiative'
      polling: false
      externalReference: ''
      content: 'mock content'
      textSearchData: 'foo, bar'
      created: *created

  - &competingInitiativeCreatedEvent
    type: COMPETING_INITIATIVE_CREATED_EVENT
    payload:
      id: *issueId
      requesterId: *voter9Id
      initiativeId: *competingInitiativeId
      name: 'Test Competing Initiative'
      externalReference: 'foobar'
      content: 'mock competing content'
      textSearchData: 'bing, bong'
      created: *competingCreated
      
      

scenarios:


  -
    label: Create new Initiative
    given: issue-creation-command/area-created
    when:
      action:
        type: HTTP_REQUEST
        uri: /issues
        method: POST
        requesterId: *voter4Id
        generate:
          id: *issueId
          initiativeId: *initiativeId
          created: *created
        body:
          unitId: *unitId
          areaId: *areaId
          policyId: *policyId
          name: 'Test Initiative'
          polling: false
          externalReference: ''
          content: 'mock content'
          textSearchData: 'foo, bar'
    then:
      outcome: *newInitiativeCreatedEvent
          
          
  -
    label: Create Competing Initiative
    given: issue-creation-command/issue-created
    when:
      action:
        type: HTTP_REQUEST
        uri: /issues/464b1ebb-32c1-460c-8e9e-666666666666/initiatives
        method: POST
        requesterId: *voter9Id
        generate:
          initiativeId: *competingInitiativeId
          created: *competingCreated
        body:
          name: 'Test Competing Initiative'
          externalReference: 'foobar'
          content: 'mock competing content'
          textSearchData: 'bing, bong'
    then:
      outcome: *competingInitiativeCreatedEvent
          
