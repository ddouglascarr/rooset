---
label: Http Issue Voting Tests
key: issue-voting-http
type: HTTP_API_TEST

mocks:
  - &unitId 464b1ebb-32c1-460c-8e9e-000000000000
  - &managerId 464b1ebb-32c1-460c-8e9e-111111111111
  - &areaId 464b1ebb-32c1-460c-8e9e-222222222222
  - &issueId 464b1ebb-32c1-460c-8e9e-333333333333
  - &policyId 464b1ebb-32c1-460c-8e9e-888888888888
  - &concernId 464b1ebb-32c1-460c-8e9a-111111111111
  - &initiativeB 464b1ebb-32c1-460c-8e9e-bbbbbbbbbbbb
  - &initiativeC 464b1ebb-32c1-460c-8e9e-cccccccccccc
  - &initiativeD 464b1ebb-32c1-460c-8e9e-dddddddddddd

  - &voter0 464b1ebb-32c1-460c-8e9f-000000000000
  - &voter1 464b1ebb-32c1-460c-8e9f-111111111111
  - &voter2 464b1ebb-32c1-460c-8e9f-222222222222
  - &voter3 464b1ebb-32c1-460c-8e9f-333333333333
  - &voter4 464b1ebb-32c1-460c-8e9f-444444444444
  - &voter5 464b1ebb-32c1-460c-8e9f-555555555555
  - &voter6 464b1ebb-32c1-460c-8e9f-666666666666
  - &voter7 464b1ebb-32c1-460c-8e9f-777777777777
  - &voter8 464b1ebb-32c1-460c-8e9f-888888888888 # weight = 2


scenarios:


  -
    label: Set Ballot on issue
    given: issue-voting-command/voting-phase
    when:
      label: A user sets a ballot on an issue
      action:
        type: HTTP_REQUEST
        uri: /issues/464b1ebb-32c1-460c-8e9e-333333333333/ballot
        method: PUT
        requesterId: *voter0
        body:
          ballot:
            approve:
              -
                - *initiativeB
            abstain:
              - *initiativeC
            disapprove:
              -
                - *initiativeD
    then:
      label: ISSUE_BALLOT_SET_EVENT recorded
      outcome:
        type: ISSUE_BALLOT_SET_EVENT
        payload:
          id: 464b1ebb-32c1-460c-8e9e-333333333333
          requesterId: *voter0
          ballot:
            approve:
              -
                - *initiativeB
            abstain:
              - *initiativeC
            disapprove:
              -
                - *initiativeD


  -
    label: Unset Ballot on issue
    given: issue-voting-command/ballot-set
    when:
      label: A user unsets their ballot on an issue
      action:
        type: HTTP_REQUEST
        uri: /issues/464b1ebb-32c1-460c-8e9e-333333333333/ballot
        method: DELETE
        requesterId: *voter0
    then:
      label: ISSUE_BALLOT_UNSET_EVENT recorded
      outcome:
        type: ISSUE_BALLOT_UNSET_EVENT
        payload:
          id: 464b1ebb-32c1-460c-8e9e-333333333333
          requesterId: *voter0
