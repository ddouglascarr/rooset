machine:
  services:
    - docker
  environment:
    ROOSET_RDB_SUPERUSER: ubuntu

#checkout:
#  post:
#    - git submodule update --init --recursive

database:
  override:
    - createuser rooset
    - createdb --owner=rooset rooset_http_integration_testing
    - psql -c "ALTER USER rooset WITH PASSWORD 'rooset';"
compile:
  override:
    - docker build -t circle-rooset --file circle.Dockerfile .

test:
  override:
    - docker run -t -e ROOSET_RDB_SUPERUSER='ubuntu' --net=host circle-rooset -c "./configure && ./run-all-tests"
